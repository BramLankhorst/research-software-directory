<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='index_style.css')}}">
    <link rel= "stylesheet" type= "text/css" href= "{{url_for('static', filename='common_style.css')}}">
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <title>NLeSC | All Software</title>


    <script type="text/javascript" src="/dynamic/data.js"></script>

</head>
<body>

    <div id="header">
        <div id="header_logo">
            <a href="https://www.esciencecenter.nl" target="_blank">
                <img src="{{url_for('static', filename='logos/nlesc.png')}}">
            </a>
        </div>
        <div id="header_text">
            Research Software Directory
        </div>
        <div id="header_links">
            <a href="/">Find software</a>
            <a href="/">About the platform</a>
        </div>
    </div>

<div class="search_bar">
    <form id="search" action="">
        <input type='text' class="search_form" id="input" value="Search for software, people, technologies, etc.">
        <input type="submit" class="search_form" id="submit" value="search" >
    </form>
</div>

<div id="box_0">
  <div id="title_bar_right">Search results</div>

  <div class="layout" id="search_results"></div>
</div>

<div id="box_1">
 <div id="title_bar_right">Highlights</div>
 <div class="layout" id="data_gems"></div>
</div>

<div id="box_2a">
  <div id="title_bar_left">Filter</div>
  <div id="filter">
  <form id="filter_form">
    <input type="checkbox" value="highlights"/><span class="checkboxtext"><b>Highlights</b></span><br>
    <input type="checkbox" value="big data"/><span class="checkboxtext">Big data</span><br>
    <input type="checkbox" value="cloud computing"/><span class="checkboxtext">Cloud computing</span><br>
    <input type="checkbox" value="image processing"/><span class="checkboxtext">Image processing</span><br>
    <input type="checkbox" value="visualisation"/><span class="checkboxtext">Visualisation</span><br>
    <input type="checkbox" value="text analysis"/><span class="checkboxtext">Text analysis and NLP</span><br>
    <input type="checkbox" value="realtime data analysis"/><span class="checkboxtext">Real time data analysis</span><br>
    <input type="checkbox" value="interoperability and linked_data"/><span class="checkboxtext">Interoperability and linked data</span>
  </form>
  </div>
</div>

<div id="box_2b">
  <div id="title_bar_left">News</div>
  <div id="mentions">
    <h2>Mentions</h2>
    <ul>
      <li>...</li>
    </ul>
  </div>
  <div id="releases">
    <h2>Releases</h2>
    <ul>
      <li>...</li>
    </ul>
  </div>
</div>


<div id="box_3"> 
  <div id="title_bar_right">All projects</div>  
  <div class="layout" id="data_display">   
  </div>
</div>


<script language="Javascript">
    function search_algo(search_key){
      search_key = search_key.toLowerCase();
      results_list = "<ul>"
        for (var i = 0; i <ALL_DATA.length; i++){
          dict = ALL_DATA[i];
          hit = false;
            for (var j =0; j < dict['discipline'].length; j++){
              term = dict['discipline'][j]
              if (term.toLowerCase().indexOf(search_key) !== -1){
                  hit=true
                  break;
              }
            }            
            for (var j = 0; j < dict['expertise'].length; j++){
              term = dict['expertise'][j]
              if (term.toLowerCase().indexOf(search_key) !== -1){
                  hit=true
                  break;
              }
            }
            for (var j = 0; j < dict['tags'].length; j++){
              term = dict['tags'][j]
              if (term.toLowerCase().indexOf(search_key) !== -1){
                  hit=true
                  break;
              }
            }            
            if (dict['tagLine'].toLowerCase().indexOf(search_key)!==-1){
              hit=true
            }
            if(hit){
              results_list += "<li>Commits:"+ALL_DATA[i]['commits']+" Name:"+ ALL_DATA[i]['name']+" Tagline:"+ ALL_DATA[i]['tagLine']+"</li>"              
            }
      }
      results_list+= "</ul>"
      return results_list
    }

     $("#input").on("focusin", function(){
        if($("#input").val()=="Search for software, people, technologies, etc."){
          $("#input").val("")
          $("#input").css('color', '#000000');
        }    
     });
     $("#input").on("focusout", function(){
        if($("#input").val()==""){
          $("#input").val("Search for software, people, technologies, etc.")
          $("#input").css('color', '#676a70');
        }
     });


     $(document).ready(function(){
        // fill gems div    
        default_number_all_projects = 6    
        project_count = 0
        for (var i = 0; i < ALL_DATA.length; i++){
          var toolTipText = '<b>'+ALL_DATA[i]['name']+'</b><br><br>'+ALL_DATA[i]['tagLine']+'<br><br>Commits : '+ALL_DATA[i]['commits']+'<br> Mentions : '+ALL_DATA[i]['mentions'];
          var appendHtml = "<div class='product' id="+i+"><a href='/software/"+ALL_DATA[i]['id']+"'><img class='product_thumb' data-placement='left' data-toggle='tooltip' data-html='true' title='" + toolTipText + "' src='static/images/thumb_default.jpg'></img></a></div>";
          if (ALL_DATA[i]['highlighted']) {
            $("#data_gems").append(appendHtml) // name, tagline, mentions, commits
          } else {
            if(project_count<default_number_all_projects){
              $("#data_display").append(appendHtml) // name, tagline, mentions, commits
              project_count += 1
            }            
          }            
        }
        $("#data_display").append("<span id='more_projects'><h2 >MORE PROJECTS</h2></span>")

        // a
        // activate Bootstrap4 on the tooltips
        $(function () {
          $('[data-toggle="tooltip"]').tooltip();
        });
     });

     $("#search").submit(function (event){
        event.preventDefault(); 
        console.log("Search query:",search.input.value)
        $("#search_results").empty()
        results_list = search_algo(search.input.value)

        $("#box_1").css("display", "none")
        $("#box_0").css("display", "block")
        $('input:checkbox:checked').prop('checked', false);
        $("#search_results").append(results_list)
        $("#search_results").css("visibility", "visible")
      });

     $("#filter").click(function (event){
        //event.preventDefault(); 
        console.log("Filter selection:")
        $('input[type=checkbox').each(function(){
            //console.log($(this).val()+" checked:"+$(this).prop('checked'))
            if ($(this).prop('checked')){
              if($(this).val()=='highlights'){
                $('#box_0').css("display", "none")
                $('#box_1').css("display", "block")
              }
            }
        })

      });


</script>

<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
</body>
</html>