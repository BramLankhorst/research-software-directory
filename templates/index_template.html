<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='index_style.css')}}">
    <link rel= "stylesheet" type= "text/css" href= "{{url_for('static', filename='common_style.css')}}">
    <link rel= "stylesheet" type= "text/css" href= "{{url_for('static', filename='software_style.css')}}">
    <link rel= "stylesheet" type= "text/css" href= "{{url_for('static', filename='read_more_style.css')}}">
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <title>NLeSC | All Software</title>


    <script type="text/javascript" src="/dynamic/data.js"></script>
    <script type="text/javascript" src="/dynamic/gems.js"></script>

</head>
<body>

    <div id="header">
        <div id="header_logo">
            <a href="https://www.esciencecenter.nl" target="_blank">
                <img src="{{url_for('static', filename='logos/nlesc.png')}}">
            </a>
        </div>
        <div id="header_text">
            Research Software Directory
        </div>
        <div id="header_links">
            <a href="/">Find software</a>
            <a href="/">About the platform</a>
        </div>
    </div>

<div class="search_bar">
    <form id="search" action="">
        <input type='text' class="search_form" id="input" value="Search for software, people, technologies, etc.">
        <input type="submit" class="search_form" id="submit" value="search" >
    </form>
</div>

<div class="search_results">
</div>

<div id="box_1">
 <div class="layout" id="data_gems">
  </div>
</div>

<div id="box_2">
  <div class="layout" id="filter">
    <input type="checkbox">Big data</input><br>
    <input type="checkbox">Cloud computing</input><br>
    <input type="checkbox">Image processing</input><br>
    <input type="checkbox">Visualisation</input><br>
    <input type="checkbox">Text analysis and NLP</input><br>
    <input type="checkbox">Real time data analysis</input><br>
    <input type="checkbox">Interoperability and linked data</input>
  </div>
  
  <div class="layout" id="data_display">   
  <div class="index_title">All software</div>   
      <ul>
      {% for template_datum in template_data %}
         <li><a href="software/{{template_datum.get('id')}}">{{template_datum.get('name')}}</a>: {{template_datum.get('tagLine')}}</li>
      {% endfor %}
      </ul>
  </div>
</div>


<script language="Javascript">
    function search_algo(dict, search_key){
      for (var term in dict['discipline']){
        if (term.indexOf(search_key) !== -1){
            return true
        }
      }
      for (var term in dict['expertise']){
        if (term.indexOf(search_key) !== -1){
            return true
        }
      }
      if (dict['tagLine'].indexOf(search_key)!==-1){
        return true
      }
    }

     $("#input").on("click", function(){
        if($("#input").val()=="Search for software, people, technologies, etc."){
          $("#input").val("")
        }    
     });

     $(document).ready(function(){
        // fill gems div
        for (var i = 0; i <gems.length; i++){
          $("#data_gems").append("<div class='gems' id="+gems[i]['id'].replace(/\s+/g, '')+">"+JSON.stringify(gems[i], null, 4)+"</div>")
        }
     });

     $("#search").submit(function (event){
        event.preventDefault(); 
        console.log("Search query:",search.input.value)
        $(".search_results").empty()
        results_list = "<ul>"
        for (var i = 0; i <ALL_DATA.length; i++){
            hit = search_algo(ALL_DATA[i], search.input.value)
            if(hit==true){
              results_list += "<li>Commits:"+ALL_DATA[i]['commits']+" Name:"+ ALL_DATA[i]['name']+" Tagline:"+ ALL_DATA[i]['tagLine']+"</li>"              
            }
        }
        results_list+= "</ul>"
        $(".search_results").append(results_list)
        $(".search_results").css("visibility", "visible")
      });
</script>
</body>
</html>